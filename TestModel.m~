function [aggAcc, aggConfusion] = TestModel(theta, thetaDecoder, testDatasets, hyperParams);


% Evaluate on test datasets, and show set-by-set results
aggConfusion = zeros(hyperParams.numRelations);
for i = 1:length(testDatasets)
    [~, ~, acc, confusion] = ComputeFullCostAndGrad(theta, thetaDecoder, testDatasets{2}{i}, hyperParams);
    if hyperParams.showConfusion
    disp(['Test confusion, PER for ', testDatasets{1}{i}, ':'])
    disp('tr:  #     =     >     <     |     ^     v')
    disp(confusion)
    disp(acc) 
    aggConfusion = aggConfusion + confusion;
end

% Compute error rate from summed confusion matrix
aggAcc = 1 - sum(sum(eye(hyperParams.numRelations) .* aggConfusion)) / sum(sum(aggConfusion));    
